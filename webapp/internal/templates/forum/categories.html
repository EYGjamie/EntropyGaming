<!-- webapp/internal/templates/forum/categories.html -->
{% extends "base.html" %}

{% block title %}Kategorien - Forum{% endblock %}

{% block page_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/forum.css') }}">
{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="forum-container">
        <div class="forum-header">
            <h1><i class="bi bi-tags"></i> Forum Kategorien</h1>
            <div class="forum-actions">
                <a href="{{ url_for('forum.index') }}" class="btn btn-secondary">
                    <i class="bi bi-arrow-left"></i> Zurück zum Forum
                </a>
                <button class="btn btn-primary" onclick="showCreateCategoryModal()">
                    <i class="bi bi-plus-lg"></i> Neue Kategorie
                </button>
            </div>
        </div>

        <!-- Categories List -->
        <div class="categories-list">
            {% if categories %}
                {% for category in categories %}
                <div class="category-card">
                    <div class="category-header">
                        <div class="category-info">
                            <h3 class="category-name">{{ category.name }}</h3>
                            {% if category.description %}
                            <p class="category-description">{{ category.description }}</p>
                            {% endif %}
                        </div>
                        <div class="category-stats">
                            <div class="stat-number">{{ category.post_count }}</div>
                            <div class="stat-label">Posts</div>
                            <br>
                        </div>
                    </div>
                    
                    <div class="category-actions">
                        <a href="{{ url_for('forum.index', category=category.id) }}" class="btn btn-outline">
                            <i class="bi bi-eye"></i> Posts anzeigen
                        </a>
                    </div>
                    <br>
                    <hr class="category-divider">
                    <br>
                </div>
                {% endfor %}
            {% else %}
                <div class="no-categories">
                    <div class="no-categories-icon">
                        <i class="bi bi-tags"></i>
                    </div>
                    <h3>Keine Kategorien vorhanden</h3>
                    <p>Erstelle die erste Kategorie für das Forum.</p>
                    <button class="btn btn-primary" onclick="showCreateCategoryModal()">
                        <i class="bi bi-plus-lg"></i> Erste Kategorie erstellen
                    </button>
                </div>
            {% endif %}
        </div>

    </div>
</div>

<!-- Create Category Modal -->
<div id="createCategoryModal" class="modal" style="display: none;">
    <div class="modal-content">
        <div class="modal-header">
            <h3><i class="bi bi-plus-circle"></i> Neue Kategorie erstellen</h3>
            <button class="modal-close" onclick="hideCreateCategoryModal()">
                <i class="bi bi-x-lg"></i>
            </button>
        </div>
        
        <form method="POST" action="{{ url_for('forum.create_category') }}" id="createCategoryForm">
            <div class="modal-body">
                <div class="form-group">
                    <label for="categoryName" class="form-label">
                        <i class="bi bi-tag"></i> Kategoriename *
                    </label>
                    <input type="text" 
                           id="categoryName" 
                           name="name" 
                           class="form-input" 
                           placeholder="z.B. Allgemein, Projekte, Support..."
                           maxlength="100"
                           required>
                    <div class="form-hint">Eindeutiger Name für die Kategorie (max. 100 Zeichen)</div>
                </div>

                <div class="form-group">
                    <label for="categoryDescription" class="form-label">
                        <i class="bi bi-file-text"></i> Beschreibung
                    </label>
                    <textarea id="categoryDescription" 
                              name="description" 
                              class="form-textarea" 
                              placeholder="Beschreibe wofür diese Kategorie verwendet wird..."
                              rows="3"
                              maxlength="500"></textarea>
                    <div class="form-hint">Optionale Beschreibung (max. 500 Zeichen)</div>
                </div>
            </div>
            
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="hideCreateCategoryModal()">
                    <i class="bi bi-x-lg"></i> Abbrechen
                </button>
                <button type="submit" class="btn btn-primary">
                    <i class="bi bi-check-lg"></i> Kategorie erstellen
                </button>
            </div>
        </form>
    </div>
</div>

{% if error %}
<div class="alert alert-error">
    {{ error }}
</div>
{% endif %}
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/forum.js') }}"></script>
<script>
function showCreateCategoryModal() {
    document.getElementById('createCategoryModal').style.display = 'flex';
    document.getElementById('categoryName').focus();
}

function hideCreateCategoryModal() {
    document.getElementById('createCategoryModal').style.display = 'none';
    document.getElementById('createCategoryForm').reset();
    
    // Reset character counters
    updateCharCounters();
}

// Close modal when clicking outside
window.addEventListener('click', function(event) {
    const modal = document.getElementById('createCategoryModal');
    if (event.target === modal) {
        hideCreateCategoryModal();
    }
});

// Close modal with Escape key
document.addEventListener('keydown', function(event) {
    if (event.key === 'Escape') {
        hideCreateCategoryModal();
    }
});

// Form validation
document.getElementById('createCategoryForm').addEventListener('submit', function(e) {
    const name = document.getElementById('categoryName').value.trim();
    
    if (!name) {
        e.preventDefault();
        ForumUtils.showNotification('Bitte geben Sie einen Kategorienamen ein.', 'error');
        return;
    }
    
    if (name.length > 100) {
        e.preventDefault();
        ForumUtils.showNotification('Der Kategoriename darf maximal 100 Zeichen lang sein.', 'error');
        return;
    }
    
    const description = document.getElementById('categoryDescription').value.trim();
    if (description.length > 500) {
        e.preventDefault();
        ForumUtils.showNotification('Die Beschreibung darf maximal 500 Zeichen lang sein.', 'error');
        return;
    }
});

// Character counters
function updateCharCounters() {
    const nameInput = document.getElementById('categoryName');
    const descInput = document.getElementById('categoryDescription');
    
    updateCharCounter(nameInput, 100, 'Eindeutiger Name für die Kategorie');
    updateCharCounter(descInput, 500, 'Optionale Beschreibung');
}

function updateCharCounter(input, maxLength, defaultText) {
    const currentLength = input.value.length;
    const hint = input.nextElementSibling;
    
    if (currentLength > maxLength * 0.8) {
        hint.innerHTML = `Noch ${maxLength - currentLength} Zeichen übrig`;
        hint.style.color = currentLength >= maxLength ? 'var(--entropy-danger)' : 'var(--entropy-warning)';
    } else {
        hint.innerHTML = `${defaultText} (max. ${maxLength} Zeichen)`;
        hint.style.color = '';
    }
}

// Initialize character counters
document.addEventListener('DOMContentLoaded', function() {
    const nameInput = document.getElementById('categoryName');
    const descInput = document.getElementById('categoryDescription');
    
    nameInput.addEventListener('input', () => updateCharCounter(nameInput, 100, 'Eindeutiger Name für die Kategorie'));
    descInput.addEventListener('input', () => updateCharCounter(descInput, 500, 'Optionale Beschreibung'));
});
</script>

<style>
/* Additional styles for categories page */
.categories-list {
    margin-bottom: 40px;
}

.category-card {
    background: var(--entropy-black-light);
    border: 1px solid var(--entropy-gray-dark);
    border-radius: var(--entropy-border-radius);
    padding: 25px;
    margin-bottom: 20px;
    box-shadow: var(--entropy-box-shadow);
    transition: var(--entropy-transition);
    position: relative;
    overflow: hidden;
}

.category-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 0;
    height: 100%;
    background: var(--entropy-gradient-main);
    transition: width 0.3s ease;
    border-radius: var(--entropy-border-radius) 0 0 var(--entropy-border-radius);
}

.category-card:hover {
    box-shadow: var(--entropy-box-shadow-lg);
    transform: translateY(-3px);
    border-color: var(--entropy-red-primary);
}

.category-card:hover::before {
    width: 4px;
}

.category-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 20px;
    position: relative;
    z-index: 2;
}

.category-info {
    flex: 1;
}

.category-name {
    color: var(--entropy-white-primary);
    margin: 0 0 10px 0;
    font-size: 1.4rem;
    font-weight: 700;
}

.category-description {
    color: var(--entropy-white-muted);
    margin: 0;
    line-height: 1.5;
}

.category-stats {
    text-align: center;
    padding: 15px 20px;
    background: var(--entropy-black-medium);
    border: 1px solid var(--entropy-gray-dark);
    border-radius: var(--entropy-border-radius-small);
    min-width: 80px;
}

.category-stats .stat-number {
    font-size: 1.8rem;
    font-weight: 900;
    color: var(--entropy-red-primary);
    font-family: 'JetBrains Mono', 'Courier New', monospace;
}

.category-stats .stat-label {
    color: var(--entropy-gray-light);
    font-size: 0.8rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.category-actions {
    display: flex;
    gap: 10px;
    position: relative;
    z-index: 2;
}

.no-categories {
    text-align: center;
    padding: 60px 20px;
    color: var(--entropy-gray-light);
    background: var(--entropy-black-light);
    border: 1px solid var(--entropy-gray-dark);
    border-radius: var(--entropy-border-radius);
}

.no-categories-icon {
    font-size: 4rem;
    margin-bottom: 20px;
    color: var(--entropy-red-primary);
    opacity: 0.5;
}

.no-categories h3 {
    margin: 0 0 10px 0;
    color: var(--entropy-white-primary);
    font-weight: 700;
}

/* Modal form styles */
.modal .form-group {
    margin-bottom: 20px;
}

.modal .form-label {
    display: block;
    font-weight: 700;
    color: var(--entropy-white-primary);
    margin-bottom: 8px;
}

.modal .form-label i {
    color: var(--entropy-red-primary);
    margin-right: 8px;
    width: 16px;
}

.modal .form-input,
.modal .form-textarea {
    width: 100%;
    padding: 12px 16px;
    border: 2px solid var(--entropy-gray-dark);
    border-radius: var(--entropy-border-radius-small);
    font-size: 16px;
    transition: var(--entropy-transition);
    font-family: inherit;
    box-sizing: border-box;
    background: var(--entropy-black-medium);
    color: var(--entropy-white-primary);
}

.modal .form-input:focus,
.modal .form-textarea:focus {
    outline: none;
    border-color: var(--entropy-red-primary);
    box-shadow: 0 0 0 2px rgba(220, 38, 38, 0.2);
}

.modal .form-input::placeholder,
.modal .form-textarea::placeholder {
    color: var(--entropy-gray-light);
}

.modal .form-textarea {
    resize: vertical;
    min-height: 80px;
}

.modal .form-hint {
    color: var(--entropy-gray-light);
    font-size: 0.9rem;
    margin-top: 5px;
    font-weight: 500;
}

/* Responsive design for categories */
@media (max-width: 768px) {
    .category-header {
        flex-direction: column;
        gap: 15px;
    }
    
    .category-stats {
        align-self: flex-start;
    }
    
    .category-actions {
        flex-direction: column;
    }
    
    .modal-content {
        max-width: 95vw;
        margin: 20px;
    }
}
</style>
{% endblock %}