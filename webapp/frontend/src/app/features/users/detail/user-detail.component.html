<div class="space-y-6">
  <!-- Loading State -->
  <div *ngIf="isLoading" class="flex justify-center items-center h-64">
    <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-indigo-600"></div>
  </div>

  <!-- Error State -->
  <div *ngIf="error" class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded">
    {{ error }}
  </div>

  <!-- Profile Content -->
  <div *ngIf="!isLoading && !error && userProfile" class="space-y-6">
    
    <!-- Profile Header -->
    <div class="bg-white shadow rounded-lg overflow-hidden">
      <div class="bg-gradient-to-r from-indigo-500 to-purple-600 h-32"></div>
      <div class="px-6 py-4">
        <div class="flex items-center -mt-16">
          <div class="relative">
            <img 
              *ngIf="hasAvatar()" 
              [src]="getAvatarUrl()" 
              [alt]="getUserDisplayName()"
              class="h-24 w-24 rounded-full border-4 border-white shadow-lg object-cover"
            />
            <div 
              *ngIf="!hasAvatar()"
              class="h-24 w-24 rounded-full border-4 border-white shadow-lg flex items-center justify-center"
              [style.background-color]="getRoleColor()"
            >
              <span class="text-white text-2xl font-bold">
                {{ getUserInitials() }}
              </span>
            </div>
          </div>
          <div class="ml-6 flex-1">
            <h1 class="text-3xl font-bold text-gray-900">
              {{ getUserDisplayName() }}
            </h1>
            <p class="text-lg" [style.color]="getRoleColor()">
              {{ userProfile.role.displayName }}
            </p>
            <div class="flex items-center space-x-4 mt-2">
              <span class="text-sm text-gray-600">
                @{{ userProfile.username }}
              </span>
              <span class="text-sm text-gray-500">
                Beigetreten: {{ formatDateShort(userProfile.createdAt) }}
              </span>
              <span *ngIf="userProfile.lastLogin" class="text-sm text-gray-500">
                Letzter Login: {{ formatDateShort(userProfile.lastLogin) }}
              </span>
            </div>
          </div>
          <div *ngIf="isOwnProfile" class="flex space-x-2">
            <a 
              [routerLink]="['/profile/edit']"
              class="bg-indigo-600 text-white px-4 py-2 rounded-md text-sm font-medium hover:bg-indigo-700 transition-colors"
            >
              Profil bearbeiten
            </a>
            <a 
              [routerLink]="['/profile/settings']"
              class="bg-gray-300 text-gray-700 px-4 py-2 rounded-md text-sm font-medium hover:bg-gray-400 transition-colors"
            >
              Einstellungen
            </a>
          </div>
          <div *ngIf="!isOwnProfile" class="flex space-x-2">
            <button 
              (click)="shareProfile()"
              class="bg-gray-300 text-gray-700 px-4 py-2 rounded-md text-sm font-medium hover:bg-gray-400 transition-colors"
            >
              ðŸ“¤ Teilen
            </button>
            <button 
              (click)="reportUser()"
              class="bg-red-600 text-white px-4 py-2 rounded-md text-sm font-medium hover:bg-red-700 transition-colors"
            >
              ðŸš« Melden
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Profile Content Grid -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
      
      <!-- Main Content -->
      <div class="lg:col-span-2 space-y-6">
        
        <!-- Bio -->
        <div class="bg-white shadow rounded-lg">
          <div class="px-6 py-4 border-b border-gray-200">
            <h2 class="text-lg font-medium text-gray-900">Ãœber mich</h2>
          </div>
          <div class="px-6 py-4">
            <p *ngIf="userProfile.profile?.bio" class="text-gray-700 whitespace-pre-wrap">
              {{ userProfile.profile.bio }}
            </p>
            <p *ngIf="!userProfile.profile?.bio" class="text-gray-500 italic">
              Keine Beschreibung vorhanden.
            </p>
          </div>
        </div>

        <!-- Statistics -->
        <div class="bg-white shadow rounded-lg">
          <div class="px-6 py-4 border-b border-gray-200">
            <h2 class="text-lg font-medium text-gray-900">Statistiken</h2>
          </div>
          <div class="px-6 py-4">
            <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
              <div class="text-center">
                <div class="text-2xl font-bold text-gray-900">{{ getUserStats().joinedDaysAgo }}</div>
                <div class="text-sm text-gray-500">Tage dabei</div>
              </div>
              <div class="text-center">
                <div class="text-2xl font-bold text-gray-900">{{ getUserStats().postsCount }}</div>
                <div class="text-sm text-gray-500">BeitrÃ¤ge</div>
              </div>
              <div class="text-center">
                <div class="text-2xl font-bold text-gray-900">{{ getUserStats().commentsCount }}</div>
                <div class="text-sm text-gray-500">Kommentare</div>
              </div>
              <div class="text-center">
                <div class="text-2xl font-bold text-gray-900">{{ getUserStats().likesReceived }}</div>
                <div class="text-sm text-gray-500">Likes erhalten</div>
              </div>
            </div>
          </div>
        </div>

        <!-- Comments Section -->
        <div class="bg-white shadow rounded-lg">
          <div class="px-6 py-4 border-b border-gray-200">
            <h2 class="text-lg font-medium text-gray-900">Kommentare</h2>
          </div>
          <div class="px-6 py-4">
            <app-comments 
              entityType="user" 
              [entityId]="userProfile.id.toString()"
              [readonly]="false">
            </app-comments>
          </div>
        </div>
      </div>

      <!-- Sidebar -->
      <div class="space-y-6">
        
        <!-- Profile Completion (only for own profile) -->
        <div *ngIf="isOwnProfile" class="bg-white shadow rounded-lg">
          <div class="px-6 py-4 border-b border-gray-200">
            <h2 class="text-lg font-medium text-gray-900">Profil-VollstÃ¤ndigkeit</h2>
          </div>
          <div class="px-6 py-4">
            <div class="mb-3">
              <div class="flex justify-between text-sm">
                <span class="text-gray-600">Fortschritt</span>
                <span class="font-medium text-gray-900">{{ getProfileCompletionPercentage() }}%</span>
              </div>
              <div class="mt-1 bg-gray-200 rounded-full h-2">
                <div 
                  class="bg-indigo-600 h-2 rounded-full transition-all duration-300"
                  [style.width.%]="getProfileCompletionPercentage()"
                ></div>
              </div>
            </div>
            <div *ngIf="!isProfileComplete()" class="text-sm text-gray-600">
              <p class="mb-2">VervollstÃ¤ndigen Sie Ihr Profil:</p>
              <ul class="space-y-1 text-xs">
                <li *ngIf="!userProfile.profile?.displayName" class="flex items-center space-x-2">
                  <span class="text-red-500">â—‹</span>
                  <span>Anzeigename hinzufÃ¼gen</span>
                </li>
                <li *ngIf="!userProfile.profile?.bio" class="flex items-center space-x-2">
                  <span class="text-red-500">â—‹</span>
                  <span>Beschreibung hinzufÃ¼gen</span>
                </li>
                <li *ngIf="!userProfile.profile?.avatarUrl" class="flex items-center space-x-2">
                  <span class="text-red-500">â—‹</span>
                  <span>Profilbild hochladen</span>
                </li>
              </ul>
            </div>
            <div *ngIf="isProfileComplete()" class="text-sm text-green-600">
              âœ“ Ihr Profil ist vollstÃ¤ndig!
            </div>
          </div>
        </div>

        <!-- Role and Permissions -->
        <div class="bg-white shadow rounded-lg">
          <div class="px-6 py-4 border-b border-gray-200">
            <h2 class="text-lg font-medium text-gray-900">Rolle & Berechtigungen</h2>
          </div>
          <div class="px-6 py-4 space-y-4">
            <!-- Role -->
            <div>
              <h3 class="text-sm font-medium text-gray-700">Rolle</h3>
              <span 
                class="inline-flex px-3 py-1 text-sm font-medium rounded-full mt-1"
                [style.background-color]="getRoleColor() + '20'"
                [style.color]="getRoleColor()"
              >
                {{ userProfile.role.displayName }}
              </span>
            </div>
            
            <!-- Permissions -->
            <div *ngIf="userProfile.permissions && userProfile.permissions.length > 0">
              <h3 class="text-sm font-medium text-gray-700 mb-2">Berechtigungen</h3>
              <div class="space-y-3">
                <div *ngFor="let category of getPermissionsByCategory() | keyvalue">
                  <h4 class="text-xs font-medium text-gray-500 uppercase tracking-wider">{{ category.key }}</h4>
                  <div class="mt-1 space-y-1">
                    <div *ngFor="let permission of category.value" class="text-sm text-gray-600">
                      â€¢ {{ permission.displayName }}
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div *ngIf="!userProfile.permissions || userProfile.permissions.length === 0">
              <p class="text-sm text-gray-500">Keine zusÃ¤tzlichen Berechtigungen</p>
            </div>
          </div>
        </div>

        <!-- Contact Info (only for own profile) -->
        <div *ngIf="isOwnProfile" class="bg-white shadow rounded-lg">
          <div class="px-6 py-4 border-b border-gray-200">
            <h2 class="text-lg font-medium text-gray-900">Kontaktinformationen</h2>
          </div>
          <div class="px-6 py-4 space-y-3">
            <div>
              <dt class="text-sm font-medium text-gray-500">E-Mail</dt>
              <dd class="text-sm text-gray-900">{{ userProfile.email }}</dd>
            </div>
            <div>
              <dt class="text-sm font-medium text-gray-500">Benutzername</dt>
              <dd class="text-sm text-gray-900">{{ userProfile.username }}</dd>
            </div>
          </div>
        </div>

        <!-- Quick Actions -->
        <div *ngIf="!isOwnProfile" class="bg-white shadow rounded-lg">
          <div class="px-6 py-4 border-b border-gray-200">
            <h2 class="text-lg font-medium text-gray-900">Aktionen</h2>
          </div>
          <div class="px-6 py-4 space-y-3">
            <button 
              (click)="shareProfile()"
              class="w-full text-left px-3 py-2 text-sm text-gray-700 hover:bg-gray-100 rounded-md transition-colors"
            >
              ðŸ“¤ Profil teilen
            </button>
            <button 
              (click)="reportUser()"
              class="w-full text-left px-3 py-2 text-sm text-red-600 hover:bg-red-50 rounded-md transition-colors"
            >
              ðŸš« Benutzer melden
            </button>
            <button 
              (click)="blockUser()"
              class="w-full text-left px-3 py-2 text-sm text-red-600 hover:bg-red-50 rounded-md transition-colors"
            >
              ðŸš· Benutzer blockieren
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>