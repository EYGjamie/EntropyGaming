<div class="space-y-6">
  <!-- Back Button -->
  <div>
    <button
      (click)="goBack()"
      class="text-indigo-600 hover:text-indigo-800 text-sm font-medium flex items-center"
    >
      ‚Üê Zur√ºck zur √úbersicht
    </button>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="bg-white shadow rounded-lg p-6">
    <div class="animate-pulse">
      <div class="flex items-center space-x-4">
        <div class="h-20 w-20 bg-gray-300 rounded-full"></div>
        <div class="flex-1 space-y-2">
          <div class="h-4 bg-gray-300 rounded w-1/4"></div>
          <div class="h-3 bg-gray-300 rounded w-1/6"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Error State -->
  <div *ngIf="error" class="bg-red-50 border border-red-200 rounded-lg p-6">
    <h3 class="text-lg font-medium text-red-900 mb-2">Fehler beim Laden</h3>
    <p class="text-red-700">{{ error }}</p>
    <button
      (click)="loadUser()"
      class="mt-4 bg-red-600 text-white px-4 py-2 rounded-md text-sm font-medium hover:bg-red-700"
    >
      Erneut versuchen
    </button>
  </div>

  <!-- User Details -->
  <div *ngIf="user && !isLoading && !error" class="space-y-6">
    <!-- User Header -->
    <div class="bg-white shadow rounded-lg overflow-hidden">
      <div class="bg-gradient-to-r from-indigo-500 to-purple-600 h-24"></div>
      <div class="px-6 py-4">
        <div class="flex items-center -mt-12">
          <div class="relative">
            <img 
              *ngIf="getAvatarUrl()" 
              [src]="getAvatarUrl()"
              [alt]="getDisplayName()"
              class="h-20 w-20 rounded-full border-4 border-white shadow-lg object-cover"
            />
            <div 
              *ngIf="!getAvatarUrl()"
              class="h-20 w-20 rounded-full bg-indigo-600 border-4 border-white shadow-lg flex items-center justify-center"
            >
              <span class="text-white text-2xl font-bold">
                {{ getDisplayName().charAt(0).toUpperCase() }}
              </span>
            </div>
            <!-- Status Indicator -->
            <div 
              class="absolute bottom-1 right-1 h-5 w-5 rounded-full border-2 border-white"
              [class]="getStatusColorClass()"
            ></div>
          </div>
          <div class="ml-6 flex-1">
            <h1 class="text-3xl font-bold text-gray-900">
              {{ getDisplayName() }}
            </h1>
            <p class="text-lg text-gray-600" *ngIf="user.nickname">
              {{ getUserTag() }}
            </p>
            <p class="text-sm text-gray-500">Discord ID: {{ user.id }}</p>
            <div class="flex items-center space-x-4 mt-2">
              <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                {{ getStatusText() }}
              </span>
              <span class="text-sm text-gray-500">
                Beigetreten: {{ formatJoinDate() }}
              </span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Stats Grid -->
    <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
      <div class="bg-white shadow rounded-lg p-6">
        <div class="flex items-center">
          <div class="text-3xl mr-4">üí¨</div>
          <div>
            <div class="text-2xl font-bold text-gray-900">{{ user.messageCount | number }}</div>
            <div class="text-sm text-gray-500">Nachrichten</div>
          </div>
        </div>
      </div>

      <div class="bg-white shadow rounded-lg p-6">
        <div class="flex items-center">
          <div class="text-3xl mr-4">üé§</div>
          <div>
            <div class="text-2xl font-bold text-gray-900">{{ formatVoiceTime() }}</div>
            <div class="text-sm text-gray-500">Voice Time</div>
          </div>
        </div>
      </div>

      <div class="bg-white shadow rounded-lg p-6">
        <div class="flex items-center">
          <div class="text-3xl mr-4">üë•</div>
          <div>
            <div class="text-2xl font-bold text-gray-900">{{ hasRoles() ? user.roles.length : 0 }}</div>
            <div class="text-sm text-gray-500">Rollen</div>
          </div>
        </div>
      </div>

      <div class="bg-white shadow rounded-lg p-6">
        <div class="flex items-center">
          <div class="text-3xl mr-4">ü§ñ</div>
          <div>
            <div class="text-2xl font-bold text-gray-900">{{ user.isBot ? 'Ja' : 'Nein' }}</div>
            <div class="text-sm text-gray-500">Bot</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Content Grid -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
      <!-- Main Content -->
      <div class="lg:col-span-2 space-y-6">
        <!-- User Information -->
        <div class="bg-white shadow rounded-lg p-6">
          <h2 class="text-lg font-medium text-gray-900 mb-4">Benutzerinformationen</h2>
          
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <label class="text-sm font-medium text-gray-500">Benutzername</label>
              <p class="text-sm text-gray-900">{{ user.username }}</p>
            </div>
            
            <div>
              <label class="text-sm font-medium text-gray-500">Discriminator</label>
              <p class="text-sm text-gray-900">#{{ user.discriminator }}</p>
            </div>
            
            <div>
              <label class="text-sm font-medium text-gray-500">Anzeigename</label>
              <p class="text-sm text-gray-900">{{ user.displayName || 'Nicht gesetzt' }}</p>
            </div>
            
            <div>
              <label class="text-sm font-medium text-gray-500">Nickname</label>
              <p class="text-sm text-gray-900">{{ user.nickname || 'Nicht gesetzt' }}</p>
            </div>
            
            <div>
              <label class="text-sm font-medium text-gray-500">Status</label>
              <p class="text-sm text-gray-900">{{ getStatusText() }}</p>
            </div>
            
            <div>
              <label class="text-sm font-medium text-gray-500">Letztes Mal gesehen</label>
              <p class="text-sm text-gray-900">{{ formatLastSeen() }}</p>
            </div>
            
            <div>
              <label class="text-sm font-medium text-gray-500">Letzte Nachricht</label>
              <p class="text-sm text-gray-900">{{ formatLastMessage() }}</p>
            </div>
          </div>
        </div>

        <!-- Roles Section -->
        <div *ngIf="hasRoles()" class="bg-white shadow rounded-lg p-6">
          <h2 class="text-lg font-medium text-gray-900 mb-4">Rollen</h2>
          <div class="flex flex-wrap gap-2">
            <span 
              *ngFor="let role of user.roles"
              class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium"
              [class]="getRoleBadgeClass(role)"
              [style]="getRoleStyle(role)"
            >
              {{ role.name }}
            </span>
          </div>
        </div>

        <!-- Activities Section -->
        <div *ngIf="hasActivities()" class="bg-white shadow rounded-lg p-6">
          <h2 class="text-lg font-medium text-gray-900 mb-4">Aktivit√§ten</h2>
          <div class="space-y-2">
            <div *ngFor="let activity of user.activities" class="flex items-center space-x-2">
              <span class="text-sm text-gray-600">{{ getActivityText(activity) }}</span>
              <span *ngIf="activity.details" class="text-xs text-gray-500">- {{ activity.details }}</span>
            </div>
          </div>
        </div>

        <!-- Notes Section -->
        <div class="bg-white shadow rounded-lg p-6">
          <h2 class="text-lg font-medium text-gray-900 mb-4">Notizen</h2>
          
          <form [formGroup]="notesForm" (ngSubmit)="onSaveNotes()" class="space-y-4">
            <div>
              <label for="notes" class="block text-sm font-medium text-gray-700">Interne Notizen</label>
              <textarea
                id="notes"
                formControlName="notes"
                rows="4"
                placeholder="F√ºgen Sie hier interne Notizen zu diesem Benutzer hinzu..."
                class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500"
                [class.border-red-300]="notesErrors.length > 0"
              ></textarea>
              <div class="mt-1 flex justify-between">
                <div class="text-red-500 text-sm" *ngIf="notesErrors.length > 0">
                  <div *ngFor="let error of notesErrors">{{ error }}</div>
                </div>
                <div class="text-xs text-gray-500">
                  {{ notesLength }}/1000 Zeichen
                </div>
              </div>
            </div>

            <div *ngIf="success" class="text-green-600 text-sm">
              {{ success }}
            </div>

            <div class="flex justify-end">
              <button
                type="submit"
                [disabled]="!notesForm.valid || isSavingNotes"
                class="bg-indigo-600 text-white px-4 py-2 rounded-md text-sm font-medium hover:bg-indigo-700 disabled:bg-indigo-400"
              >
                {{ isSavingNotes ? 'Wird gespeichert...' : 'Notizen speichern' }}
              </button>
            </div>
          </form>
        </div>
      </div>

      <!-- Sidebar -->
      <div class="space-y-6">
        <!-- Quick Stats -->
        <div class="bg-white shadow rounded-lg p-6">
          <h3 class="text-lg font-medium text-gray-900 mb-4">Schnellstatistiken</h3>
          <div class="space-y-3">
            <div class="flex justify-between">
              <span class="text-sm text-gray-500">Nachrichten:</span>
              <span class="text-sm font-medium text-gray-900">{{ user.messageCount | number }}</span>
            </div>
            <div class="flex justify-between">
              <span class="text-sm text-gray-500">Voice Time:</span>
              <span class="text-sm font-medium text-gray-900">{{ formatVoiceTime() }}</span>
            </div>
            <div class="flex justify-between">
              <span class="text-sm text-gray-500">Rollen:</span>
              <span class="text-sm font-medium text-gray-900">{{ hasRoles() ? user.roles.length : 0 }}</span>
            </div>
            <div class="flex justify-between">
              <span class="text-sm text-gray-500">Bot:</span>
              <span class="text-sm font-medium text-gray-900">{{ user.isBot ? 'Ja' : 'Nein' }}</span>
            </div>
          </div>
        </div>

        <!-- Discord Avatar -->
        <div class="bg-white shadow rounded-lg p-6">
          <h3 class="text-lg font-medium text-gray-900 mb-4">Discord Avatar</h3>
          <div class="text-center">
            <img 
              *ngIf="getAvatarUrl()" 
              [src]="getAvatarUrl()"
              [alt]="getDisplayName()"
              class="h-32 w-32 rounded-full mx-auto object-cover border-4 border-gray-200"
            />
            <div 
              *ngIf="!getAvatarUrl()"
              class="h-32 w-32 rounded-full bg-indigo-600 mx-auto flex items-center justify-center border-4 border-gray-200"
            >
              <span class="text-white text-4xl font-bold">
                {{ getDisplayName().charAt(0).toUpperCase() }}
              </span>
            </div>
            <p class="text-sm text-gray-500 mt-2">{{ getDisplayName() }}</p>
            <p class="text-xs text-gray-400">{{ getUserTag() }}</p>
          </div>
        </div>

        <!-- Actions -->
        <div class="bg-white shadow rounded-lg p-6">
          <h3 class="text-lg font-medium text-gray-900 mb-4">Aktionen</h3>
          <div class="space-y-2">
            <button class="w-full bg-indigo-600 text-white px-4 py-2 rounded-md text-sm font-medium hover:bg-indigo-700">
              Discord Profil √∂ffnen
            </button>
            <button class="w-full bg-gray-300 text-gray-700 px-4 py-2 rounded-md text-sm font-medium hover:bg-gray-400">
              Nachrichtenverlauf anzeigen
            </button>
            <button class="w-full bg-yellow-300 text-yellow-800 px-4 py-2 rounded-md text-sm font-medium hover:bg-yellow-400">
              Daten synchronisieren
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Comments Section -->
    <div class="bg-white shadow rounded-lg p-6">
      <h2 class="text-lg font-medium text-gray-900 mb-4">Kommentare</h2>
      <app-comments 
        [entityType]="'discord_user'" 
        [entityId]="user.id"
        [allowComments]="true">
      </app-comments>
    </div>
  </div>
</div>